<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Continuous integration in Python, Volume 2: measuring test coverage | I Love Symposia!</title>
<link href="../../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://ilovesymposia.com/2014/10/02/continuous-integration-1-test-coverage/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Juan Nunez-Iglesias">
<link rel="prev" href="../../01/continuous-integration-0-automated-tests-with-pytest/" title="Continuous integration in Python, Volume 1: automated tests with pytest" type="text/html">
<link rel="next" href="../../13/continuous-integration-in-python-3-set-up-your-test-configuration-files/" title="Continuous integration in Python 3: set up your test configuration files" type="text/html">
<meta property="og:site_name" content="I Love Symposia!">
<meta property="og:title" content="Continuous integration in Python, Volume 2: measuring test coverage">
<meta property="og:url" content="https://ilovesymposia.com/2014/10/02/continuous-integration-1-test-coverage/">
<meta property="og:description" content="(Edit: I initially thought it would be cute to number from 0. But it turns out it becomes rather obnoxious to relate English (first, second, ...) to 0-indexing. So this was formerly volume 1. But ever">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-10-02T01:04:04+10:00">
<meta property="article:tag" content="continuous integration">
<meta property="article:tag" content="Planet SciPy">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="test-driven development">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../../archive.html">Archives</a>
        <a class="sidebar-nav-item" href="../../../../categories/index.html">Tags</a>
        <a class="sidebar-nav-item" href="../../../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://ilovesymposia.com/" title="I Love Symposia!" rel="home">I Love Symposia!</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Continuous integration in Python, Volume 2: measuring test coverage</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2014-10-02T01:04:04+10:00" itemprop="datePublished" title="2014-10-02 01:04">2014-10-02 01:04</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2014/10/02/continuous-integration-1-test-coverage.html">Comments</a>


        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p></p>
<p>(<strong>Edit</strong>: I initially thought it would be cute to number from 0. But it turns out it becomes rather obnoxious to relate English (first, second, ...) to 0-indexing. So this was formerly volume 1. But everything else remains the same.)</p>
<p>This is the second post in a series about setting up continuous integration for a Python project from scratch. For the first post, see <a href="http://ilovesymposia.com/2014/10/01/continuous-integration-0-automated-tests-with-pytest/">Automated tests with pytest</a>.</p>
<p>After you've written some test cases for a tiny project, it's easy to check what code you have automatically tested. For even moderately big projects, you will need tools that automatically check what parts of your code are actually tested. The proportion of lines of code that are run at least once during your tests is called your <em>test coverage</em>.</p>
<p>For the same reasons that testing is important, measuring coverage is important. Pytest can measure coverage for you with the coverage plugin, found in the <a href="https://pypi.python.org/pypi/pytest-cov">pytest-cov</a> package. Once you've installed the extension, a test coverage measurement is just a command-line option away:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=text]</span>
 <span class="na">~/projects/maths $ py.test --doctest-modules --cov .</span>
<span class="o">=</span><span class="s">============================ test session starts ==============================</span>
<span class="na">platform darwin -- Python 2.7.8 -- py-1.4.25 -- pytest-2.6.3</span>
<span class="na">plugins: cov</span>
<span class="na">collected 2 items </span>

<span class="na">maths.py .</span>
<span class="na">test_maths.py .</span>
<span class="na">--------------- coverage: platform darwin, python 2.7.8-final-0 ----------------</span>
<span class="na">Name         Stmts   Miss  Cover</span>
<span class="na">--------------------------------</span>
<span class="na">maths            2      0   100%</span>
<span class="na">test_maths       4      0   100%</span>
<span class="na">--------------------------------</span>
<span class="na">TOTAL            6      0   100%</span>

<span class="o">=</span><span class="s">========================== 2 passed in 0.07 seconds ===========================</span>
<span class="k">[/code]</span>
</pre>


<p>(The <code>--cov</code> takes a directory as input, which I find obnoxious, given that py.test so naturally defaults to the current directory. But it is what it is.)</p>
<p>Now, if I add a function without a test, I'll see my coverage drop:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=text]</span>
<span class="na">def sqrt(x):</span>
    <span class="na">"""Return the square root of `x`."""</span>
    <span class="na">return x * 0.5</span>
<span class="k">[/code]</span>
</pre>


<p>(The typo is intentional.)</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=text]</span>
<span class="na">--------------- coverage: platform darwin, python 2.7.8-final-0 ----------------</span>
<span class="na">Name         Stmts   Miss  Cover</span>
<span class="na">--------------------------------</span>
<span class="na">maths            4      1    75%</span>
<span class="na">test_maths       4      0   100%</span>
<span class="na">--------------------------------</span>
<span class="na">TOTAL            8      1    88%</span>
<span class="k">[/code]</span>
</pre>


<p>With one more option, <code>--cov-report term-missing</code>, I can see which lines I <em>haven't</em> covered, so I can try to design tests specifically for that code:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=text]</span>
<span class="na">--------------- coverage: platform darwin, python 2.7.8-final-0 ----------------</span>
<span class="na">Name         Stmts   Miss  Cover   Missing</span>
<span class="na">------------------------------------------</span>
<span class="na">maths            4      1    75%   24</span>
<span class="na">test_maths       4      0   100%   </span>
<span class="na">------------------------------------------</span>
<span class="na">TOTAL            8      1    88%   </span>
<span class="k">[/code]</span>
</pre>


<p>Do note that 100% coverage does not ensure correctness. For example, suppose I test my <code>sqrt</code> function like so:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">def sqrt(x):</span>
    <span class="na">"""Return the square root of `x`.</span>

    <span class="na">Examples</span>
    <span class="na">--------</span>
    <span class="na">&amp;gt;&amp;gt;&amp;gt; sqrt(4.0)</span>
    <span class="na">2.0</span>
    <span class="na">"""</span>
    <span class="na">return x * 0.5</span>
<span class="k">[/code]</span>
</pre>


<p>Even though my test is correct, and I now have 100% test coverage, I haven't detected my mistake. Oops!</p>
<p>But, keeping that caveat in mind, full test coverage <em>is</em> a wonderful thing, and if you don't test something, you're guaranteed not to catch errors. Further, my example above is quite contrived, and in most situations full test coverage <em>will</em> spot most errors.</p>
<p>That's it for part 2. Tune in next time to learn how to turn on <a href="https://travis-ci.org">Travis</a> continuous integration for your GitHub projects!</p>
<p><strong>Update:</strong> <a href="http://ilovesymposia.com/2014/10/13/continuous-integration-in-python-3-set-up-your-test-configuration-files/">Volume 3: set up config files.</a></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/continuous-integration/" rel="tag">continuous integration</a></li>
            <li><a class="tag p-category" href="../../../../categories/planet-scipy/" rel="tag">Planet SciPy</a></li>
            <li><a class="tag p-category" href="../../../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../../../categories/python/" rel="tag">Python</a></li>
            <li><a class="tag p-category" href="../../../../categories/test-driven-development/" rel="tag">test-driven development</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../01/continuous-integration-0-automated-tests-with-pytest/" rel="prev" title="Continuous integration in Python, Volume 1: automated tests with pytest">Previous post</a>
            </li>
            <li class="next">
                <a href="../../13/continuous-integration-in-python-3-set-up-your-test-configuration-files/" rel="next" title="Continuous integration in Python 3: set up your test configuration files">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="https://ilovesymposia.com/2014/10/02/continuous-integration-1-test-coverage/",
        disqus_title="Continuous integration in Python, Volume 2: measuring test coverage",
        disqus_identifier="cache/posts/2014/10/02/continuous-integration-1-test-coverage.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2019         <a href="mailto:jni.soma@fastmail.com">Juan Nunez-Iglesias</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
