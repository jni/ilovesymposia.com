<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Continuous integration in Python, Volume 1: automated tests with pytest | I Love Symposia!</title>
<link href="../../../../assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../../rss.xml">
<link rel="canonical" href="https://ilovesymposia.com/2014/10/01/continuous-integration-0-automated-tests-with-pytest/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Juan Nunez-Iglesias">
<link rel="prev" href="../../../09/22/use-pmset-to-restore-your-macs-instant-wake-after-upgrading-to-yosemite/" title="Use pmset to restore your Mac's instant-wake after upgrading to Yosemite" type="text/html">
<link rel="next" href="../../02/continuous-integration-1-test-coverage/" title="Continuous integration in Python, Volume 2: measuring test coverage" type="text/html">
<meta property="og:site_name" content="I Love Symposia!">
<meta property="og:title" content="Continuous integration in Python, Volume 1: automated tests with pytes">
<meta property="og:url" content="https://ilovesymposia.com/2014/10/01/continuous-integration-0-automated-tests-with-pytest/">
<meta property="og:description" content="(Edit: I initially thought it would be cute to number from 0. But it turns out it becomes rather obnoxious to relate English (first, second, …) to 0-indexing. So this was formerly volume 0. But everyt">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-10-01T01:40:41+10:00">
<meta property="article:tag" content="continuous integration">
<meta property="article:tag" content="Planet SciPy">
<meta property="article:tag" content="programming">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="test-driven development">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>
            A blog about Python, science, and the odd random thing I care enough about.
            </p>
            <p>
            Theme modified from <a href="https://themes.getnikola.com/v7/lanyon/">Lanyon</a>.
            Created by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to <a href="https://getnikola.com">Nikola</a> by
            <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.
            </p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="../../../../archive.html">Archives</a>
        <a class="sidebar-nav-item" href="../../../../categories/index.html">Tags</a>
        <a class="sidebar-nav-item" href="../../../../rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="https://ilovesymposia.com/" title="I Love Symposia!" rel="home">I Love Symposia!</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="post-title p-name entry-title" itemprop="headline name"><a href="." class="u-url">Continuous integration in Python, Volume 1: automated tests with pytest</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="." rel="bookmark"><time class="post-date published dt-published" datetime="2014-10-01T01:40:41+10:00" itemprop="datePublished" title="2014-10-01 01:40">2014-10-01 01:40</time></a></p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2014/10/01/continuous-integration-0-automated-tests-with-pytest.html">Comments</a>


        </p>
</div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>(<strong>Edit</strong>: I initially thought it would be cute to number from 0. But it turns out it becomes rather obnoxious to relate English (first, second, …) to 0-indexing. So this was formerly volume 0. But everything else remains the same.)</p>
<p>I just finished the process of setting up continuous integration <em>from scratch</em> for one of my projects, <a href="https://github.com/jni/cellom2tif">cellom2tif</a>, a simple image file converter/liberator. I thought I would write a blog post about that process, but it has slowly mutated into a hefty document that I thought would work better as a series. I'll cover automated testing, test coverage, and how to get these to run automatically for your project with <a href="https://travis-ci.org">Travis-CI</a> and <a href="https://coveralls.io">Coveralls</a>.</p>
<p>Without further ado, here goes the first post: how to set up automated testing for your Python project using <a href="http://pytest.org/latest/">pytest</a>.</p>
<!-- TEASER_END -->

<h3>Automated tests, and why you need them</h3>

<p>Software engineering is hard, and it's incredibly easy to mess things up, so you should write <em>tests</em> for all your functions, which ensure that nothing obviously stupid is going wrong. Tests can take a lot of different forms, but here's a really basic example. Suppose this is a function in your file, <code>maths.py</code>:</p>
<pre class="code literal-block"><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
</pre>


<p>Then, elsewhere in your package, you should have a file <code>test_maths.py</code> with the following function definition:</p>
<pre class="code literal-block"><span></span><span class="kn">from</span> <span class="nn">maths</span> <span class="kn">import</span> <span class="n">square</span>

<span class="k">def</span> <span class="nf">test_square</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">assert</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>
</pre>


<p>This way, if someone (such as your future self) comes along and messes with the code in <code>square()</code>, <code>test_square</code> will tell you whether they broke it.
</p>
<h3>Testing in Python with pytest</h3>
A whole slew of testing frameworks, such as <a href="https://nose.readthedocs.org/en/latest/">nose</a>, will then traverse your project, look for files and functions whose names begin with <code>test_</code>, run them, and report any errors or assertion failures.
<p>I've chosen to use <a href="http://pytest.org/latest/">pytest</a> as my framework because:
</p>
<ul>
<li>it is a strict superset of both nose and Python's built-in unittest, so that if you run it on projects set up with those, it'll work out of the box;</li>
    <li>its output is more readable than nose's; and</li>
    <li>its <a href="http://pytest.org/latest/fixture.html#fixture">fixtures</a> provide a very nice syntax for test setup and cleanup.</li>
</ul>
For a quick intro to pytest, you can watch Andreas Pelme's talk at this year's EuroPython conference:
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/LdVJj65ikRY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>But the basics are very simple: sprinkle files named <code>test_something.py</code> throughout your project, each containing one or more <code>test_function()</code> definition; then type <code>py.test</code> on the command line (at your project root directory), and voila! Pytest will traverse all your subdirectories, gather up all the test files and functions, and run your tests.</p>
<p>Here's the output for the minimal <code>maths</code> project described above:</p>
<pre class="code literal-block"><span></span>~/projects/maths $ py.test
============================= test session starts ==============================
platform darwin -- Python 2.7.8 -- py-1.4.20 -- pytest-2.5.2
collected 1 items

test_maths.py .

=========================== 1 passed in 0.03 seconds ===========================
</pre>


<p>In addition to the test functions described above, there is a Python standard called <a href="https://docs.python.org/2/library/doctest.html">doctest</a> in which properly formatted usage examples in your documentation are automatically run as tests. Here's an example:</p>
<pre class="code literal-block"><span></span><span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">"""Return the square of a number `x`.</span>

<span class="sd">    [...]</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; square(5)</span>
<span class="sd">    25</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
</pre>


<p>(See my <a href="http://ilovesymposia.com/2014/01/09/best-practices-addendum-find-and-follow-the-conventions-of-your-programming-community/">post on NumPy docstring conventions</a> for what should go in the ellipsis above.)</p>
<p>Depending the complexity of your code, doctests, test functions, or both will be the appropriate route. Pytest supports doctests with the <code>--doctest-modules</code> flag. (This runs both your standard tests <em>and</em> doctests.)</p>
<pre class="code literal-block"><span></span>~/projects/maths $ py.test --doctest-modules
============================= test session starts ==============================
platform darwin -- Python 2.7.8 -- py-1.4.20 -- pytest-2.5.2
collected 2 items

maths.py .
test_maths.py .

=========================== 2 passed in 0.06 seconds ===========================
</pre>


<h3>Test-driven development</h3>

<p>That was easy! And yet most people, my past self included, neglect tests, thinking they'll do them eventually, when the software is ready. This is backwards. You've probably heard the phrase "Test-driven development (TDD)"; this is what they're talking about: writing your tests <em>before</em> you've written the functionality to pass them. It might initially <em>seem</em> like wasted effort, like you're not making progress in what you actually want to do, which is write your software. But it's not:</p>
<p>https://twitter.com/zspencer/status/514447236239859712</p>
<p>By spending a bit of extra effort to prevent bugs down the road, you will get to where you want to go faster.</p>
<p>That's it for volume 1! Watch out for the next post: ensuring your tests are thorough by measuring <em>test coverage</em>.</p>
<p><strong>Update:</strong> <a href="http://ilovesymposia.com/2014/10/02/continuous-integration-1-test-coverage/">Volume 2: measuring test coverage</a></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/continuous-integration/" rel="tag">continuous integration</a></li>
            <li><a class="tag p-category" href="../../../../categories/planet-scipy/" rel="tag">Planet SciPy</a></li>
            <li><a class="tag p-category" href="../../../../categories/programming/" rel="tag">programming</a></li>
            <li><a class="tag p-category" href="../../../../categories/python/" rel="tag">Python</a></li>
            <li><a class="tag p-category" href="../../../../categories/test-driven-development/" rel="tag">test-driven development</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../../09/22/use-pmset-to-restore-your-macs-instant-wake-after-upgrading-to-yosemite/" rel="prev" title="Use pmset to restore your Mac's instant-wake after upgrading to Yosemite">Previous post</a>
            </li>
            <li class="next">
                <a href="../../02/continuous-integration-1-test-coverage/" rel="next" title="Continuous integration in Python, Volume 2: measuring test coverage">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="ilovesymposia",
            disqus_url="https://ilovesymposia.com/2014/10/01/continuous-integration-0-automated-tests-with-pytest/",
        disqus_title="Continuous integration in Python, Volume 1: automated tests with pytest",
        disqus_identifier="cache/posts/2014/10/01/continuous-integration-0-automated-tests-with-pytest.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="ilovesymposia";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2019         <a href="mailto:jni.soma@fastmail.com">Juan Nunez-Iglesias</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
<img alt="Creative Commons License BY" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a></p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="../../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
