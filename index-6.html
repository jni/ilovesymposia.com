<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Science &amp; Tech for the Small Fry">
<meta name="viewport" content="width=device-width">
<title>I Love Symposia! (old posts, page 6) | I Love Symposia!</title>
<link href="assets/css/all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://ilovesymposia.com/index-6.html">
<link rel="prev" href="." type="text/html">
<link rel="next" href="index-5.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]-->
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
            styles, `#sidebar-checkbox` for behavior. -->
    <input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox"><!-- Toggleable sidebar --><div class="sidebar" id="sidebar">
        <div class="sidebar-item">
            <p>A reserved <a href="https://getnikola.com" target="_blank">Nikola</a> theme that places the utmost gravity on content with a hidden drawer. Made by <a href="https://twitter.com/mdo" target="_blank">@mdo</a> for Jekyll,
            ported to Nikola by <a href="https://twitter.com/ralsina" target="_blank">@ralsina</a>.</p>
        </div>
        
    <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href="archive.html">Archives</a>
        <a class="sidebar-nav-item" href="categories/index.html">Tags</a>
        <a class="sidebar-nav-item" href="rss.xml">RSS feed</a>
    
    
    </nav>
</div>

    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          
    <h3 id="brand" class="masthead-title">
      <a href="http://ilovesymposia.com/" title="I Love Symposia!" rel="home">I Love Symposia!</a>
    </h3>

        </div>
      </div>

      <div class="container content" id="content">
        

<div class="posts">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/2015/12/26/why-scientists-should-code-in-the-open/" class="u-url">Why scientists should code in the open</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="posts/2015/12/26/why-scientists-should-code-in-the-open/" rel="bookmark"><time class="post-date published dt-published" datetime="2015-12-26T16:17:05+00:00" title="2015-12-26 16:17">2015-12-26 16:17</time></a></p>
                <p class="commentline">
        
    <a href="posts/2015/12/26/why-scientists-should-code-in-the-open/#disqus_thread" data-disqus-identifier="cache/posts/2015/12/26/why-scientists-should-code-in-the-open.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p></p>
<p>All too often, I encounter <em>published papers</em> in which the code is "available upon request", or "available in the supplementary materials" (as a zip file). This is not just poor form. It also hurts your software's future. (And, in my opinion, when results depend on software, it is inexcusable.)</p>
<p>Given the numerous options for posting code online, there's just no excuse to give code in a less-than-convenient format, upon publication. When you publish, put your code on <a href="https://github.com">Github</a> or <a href="https://bitbucket.com">Bitbucket</a>.</p>
<p>In this piece, I'll go even further: put your code there <em>from the beginning</em>. Put your code there <em>as soon as you finish reading this article</em>. Here's why:</p>
<p></p>
<h3>No, you won't get scooped</h3>
<p>Reading code is <em>hard</em>. Ask any experienced programmer: most have trouble reading code <em>they themselves wrote</em> a few months ago, let alone someone else's code. It's extremely unlikely that someone will browse your code looking for a scoop. That time is better spent doing research.</p>
<h3>It's never going to be ready</h3>

<p>Another thing I hear is that they <em>want</em> to post their code, but they want to clean it up first, and remove all the "embarrassing" bits. Unfortunately, science doesn't reward time spent "cleaning up" your code, at least not yet. So the sad reality is that you probably will never actually get to the point where you are happy to post your code online.</p>
<p>But here's the secret: <em>everybody is in that boat with you</em>. That's why <a href="http://matt.might.net/articles/crapl/">this document</a> exists. I recommend you read it in full, but this segment is particularly important:</p>
<blockquote>
  When it comes time to empirically evaluate new research with respect to someone else's prior work, even a rickety implementation of their work can save grad-student-months, or even grad-student-years, of time.
</blockquote>

<p>Matt Might himself is as thorough and high-profile as you get in computer science, and yet, he has this to say about code clean-up:</p>
<blockquote>
  I kept telling myself that I'd clean it all up and release it some day.

  I have to be honest with myself: this clean-up is never going to happen.
</blockquote>

<p>Your code might not meet your standards, but, believe it or not, your code <em>will</em> help others, and the sooner it's out there, the sooner they can be helped.</p>
<h3>You will gain collaborators and citations</h3>

<p>If anyone is going to be rifling through your code, they will probably end up asking for your help. This happens with even the best projects: have a look at the activity on the mailing lists for <a href="http://sourceforge.net/p/scikit-learn/mailman/scikit-learn-general/">scikit-learn</a> or <a href="http://www.mail-archive.com/numpy-discussion@scipy.org/">NumPy</a>, two of the best-maintained open-source projects out there.</p>
<p>When you have to go back and explain how a piece of code worked, <em>that's</em> when you will actually take the time and clean it up. In the process, the person you help will be more likely to contribute to your project, either in code or in bug reports, improvement suggestions, or even citations.</p>
<p>In the case of my own <a href="https://github.com/janelia-flyem/gala">gala</a> project, I guess that about half of the citations it received happened because of its open-source code and open <a href="http://gala.30861.n7.nabble.com">mailing list</a>.</p>
<h3>Your coding ability will automagically improve</h3>

<p>I first heard this one from <a href="http://albert.rierol.net">Albert Cardona</a>. They say sunlight is the best disinfectant, and this is certainly true of code. Just the very idea that anyone can easily read their code will make most people more careful when programming. Over time, this care will become second nature, and you will develop a taste for nice, easy-to-read code.</p>
<p>In short, the alleged downsides of code-sharing are, at best, longshots, while there are many tangible upsides. Put your code out there. (And use a <a href="http://www.astrobetter.com/blog/2014/03/10/the-whys-and-hows-of-licensing-scientific-code/">liberal open-source license</a>!)</p>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/2015/12/10/the-cost-of-a-python-function-call/" class="u-url">The cost of a Python function call</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="posts/2015/12/10/the-cost-of-a-python-function-call/" rel="bookmark"><time class="post-date published dt-published" datetime="2015-12-10T01:04:00+00:00" title="2015-12-10 01:04">2015-12-10 01:04</time></a></p>
                <p class="commentline">
        
    <a href="posts/2015/12/10/the-cost-of-a-python-function-call/#disqus_thread" data-disqus-identifier="cache/posts/2015/12/10/the-cost-of-a-python-function-call.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p></p>
<p>I've read in various places that the Python function call overhead is very high. As I was parroting this "fact" to <a href="https://twitter.com/edschofield">Ed Schofield</a> recently, he asked me what the cost of a function actually was. I had no idea. This prompted us to do a few quick benchmarks.</p>
<p>The short version is that it takes about 150ns to call a function in Python (on my laptop). This doesn't sound like a lot, but it means that you can make <em>at most</em> 6.7 million calls per second, two to three orders of magnitude slower than your processor's clock speed.</p>
<p>If you want your function to do something, such as, oh, I don't know, <em>receive an input argument</em>, this goes up to 350ns, throttling you at 2.8 million calls per second.</p>
<p></p>
<h3>Benchmarking function calls</h3>
<p>I cleaned up Ed's and my initial experiments to make a small <a href="https://github.com/jni/performance-tests/blob/master/function-calls/f.py">module</a> and <a href="https://github.com/jni/performance-tests/blob/master/function-calls/timer.py">timer</a> to measure all these values. You can clone the <a href="https://github.com/jni/performance-tests">repo</a> and run <code>python function-calls/timer.py</code> to check the numbers on your machine.</p>
<p>The benchmarks are variations of comparing the execution time of:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">for i in range(n):</span>
    <span class="na">pass</span>
<span class="k">[/code]</span>
</pre>


<p>and:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">def f():</span>
    <span class="na">pass</span>

<span class="na">for i in range(n):</span>
    <span class="na">f()</span>
<span class="k">[/code]</span>
</pre>


<p>for some suitably large <code>n</code>. As I mentioned above, that comes out to an absolute minimum of 150ns per function call.</p>
<h3>What this means</h3>

<p>I've been making a fuss over the past year about the excellent Toolz and the way it enables elegant streaming data processing. (See my <a href="https://github.com/jni/streaming-talk">demo repo</a> and my <a href="https://www.youtube.com/watch?v=cMo4fnCbSPc">EuroSciPy talk</a>.) You can read data from a modern SSD at speeds approaching 500MB/s. If you want to stream each byte through Python functions, you'll <em>instantly</em> lose two orders of magnitude of speed. And, the more functions you use, the slower you'll go, which discourages functional programming and modularity — the very things I was trying to promote!</p>
<p>In the DNA sequence processing I demo in the talk, I get a throughput of about 0.5MB/s. On one hand, this is kind of OK because we are using effectively zero RAM, so we can just let the code run over lunch. On the other, it's starting to bug me that 99% of my processor time is spent on Python function calls, rather than on actual data crunching.</p>
<p>This is a problem for Python. To work on seriously big data, you need to drop into a library written in C, such as NumPy or Pandas. You need to do this on a high level: any per-byte or per-data-element processing <em>cannot</em> be in Python, if you don't want to waste your processor's cycles. Python's ecosystem is Insanely Great, so this is mostly fine, but it does limit your ability to research or implement cool new methods using Python.</p>
<p>As an example, the <a href="http://docs.scipy.org/doc/scipy/reference/generated/scipy.ndimage.filters.generic_filter.html"><code>generic_filter</code></a> function in SciPy's <code>ndimage</code> package has infinitely many cool <a href="http://ilovesymposia.com/2014/06/24/a-clever-use-of-scipys-ndimage-generic_filter-for-n-dimensional-image-processing/">uses</a>, but using it to process a 100MB image (which is small in biology) would take 15 seconds in function call overhead <em>alone</em>. Lest you think this is reasonable, SciPy's greyscale erosion, implemented in C, takes less than 4 seconds on an image that size. A lot of my once-lackadaisical attitude towards Python performance stemmed from not knowing how long things <em>should</em> take. A lot less than they do, it turns out.</p>
<h3>What to do about it</h3>

<p>As I mentioned, Python's high performance libraries are many and great. Look hard for optimised libraries that already do what you want. Try to express what you want to do as combinations of functions from NumPy, SciPy, Pandas, scikit-image, scikit-learn, and so on. Minimise the amount of time spent in Python. This is advice that you learn early on in scientific Python programming, but I didn't appreciate just how important it is.</p>
<p>At some point, that approach will fail, and you will want to do something cute and custom with your data points. Reach for <a href="http://cython.readthedocs.org">Cython</a> sooner rather than later. As a primer, I recommend Stefan Behnel's excellent <a href="https://youtu.be/GmxZfZjEjZo">tutorial</a> from EuroSciPy 2015.</p>
<p>There is also Continuum's <a href="http://numba.pydata.org">Numba</a>, which is sometimes easier to use than Cython. I don't have any experience with it so I can't comment much here. However, I'd consider it a very valuable project to implement <code>generic_filter</code> in Numba.
In the long-run, these are all workarounds, and I hope that the Python interpreter itself becomes faster, though there are few signs of that happening.</p>
<p>If you have other ideas on how to get around Python's function call cost, please let me know in the comments!</p>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/2015/10/19/first-yield-from/" class="u-url">My first use of Python 3's `yield from`!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="posts/2015/10/19/first-yield-from/" rel="bookmark"><time class="post-date published dt-published" datetime="2015-10-19T22:19:35+00:00" title="2015-10-19 22:19">2015-10-19 22:19</time></a></p>
                <p class="commentline">
        
    <a href="posts/2015/10/19/first-yield-from/#disqus_thread" data-disqus-identifier="cache/posts/2015/10/19/first-yield-from.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p></p>
<p>I never really understood why <code>yield from</code> was useful. Last weekend, I wanted to use Python 3.5's new <code>os.scandir</code> to explore a directory (and its subdirectories). Tragically, <code>os.scandir</code> is <em>not</em> recursive, and I find <code>os.walk</code>s 3-tuple values obnoxious.
Lo and behold, while I was trying to implement a recursive version of <code>scandir</code>, a <code>yield from</code> use just popped right out!</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">import os</span>
<span class="na">def rscandir(path):</span>
    <span class="na">for entry in os.scandir(path):</span>
        <span class="na">yield entry</span>
        <span class="na">if entry.is_dir():</span>
            <span class="na">yield from rscandir(entry.path)</span>
<span class="k">[/code]</span>
</pre>


<p>That's it! I have to admit that reads wonderfully. The Legacy Python (aka Python 2.x) alternative is quite a bit uglier:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">import os</span>
<span class="na">def rscandir(path):</span>
    <span class="na">for p in os.listdir(path):</span>
        <span class="na">yield p</span>
        <span class="na">if os.path.isdir(p):</span>
            <span class="na">for q in rscandir(p):</span>
                <span class="na">yield q</span>
<span class="k">[/code]</span>
</pre>


<p>Yuck. So, yet again: time to move away from Legacy Python! ;)</p>
</div>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/2015/10/09/euroscipy-2015-debrief/" class="u-url">EuroSciPy 2015 debrief</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Juan Nunez-Iglesias</span></p>
            <p class="dateline"><a href="posts/2015/10/09/euroscipy-2015-debrief/" rel="bookmark"><time class="post-date published dt-published" datetime="2015-10-09T01:06:01+00:00" title="2015-10-09 01:06">2015-10-09 01:06</time></a></p>
                <p class="commentline">
        
    <a href="posts/2015/10/09/euroscipy-2015-debrief/#disqus_thread" data-disqus-identifier="cache/posts/2015/10/09/euroscipy-2015-debrief.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p></p>
<p>The videos from EuroSciPy 2015 are <a href="https://www.youtube.com/playlist?list=PLYx7XA2nY5GeQCCugyvtnHMVLdhYlrRxH">up</a>! This marks a good time to write up my thoughts on the conference.
I’ve <a href="http://ilovesymposia.com/2015/03/23/go-to-scipy-2015/">mentioned before</a> that the yearly SciPy conference is stunningly useful. This year I couldn’t make it to Austin, but I did attend <a href="https://www.euroscipy.org/2015/">EuroSciPy</a>, the European version of the same conference, in Cambridge, UK. It was spectacular.</p>
<p></p>
<h3>Useful talks</h3>
<p>The talk of the conference, for me, goes to <a href="https://youtu.be/8tysix6Olgc">Robin Wilson for recipy</a>, which one can describe as a logging utility, if one wishes to make it sound as uninspiring as possible. Recipy’s strength is in its mind-boggling simplicity. Here is the unabridged usage guide:</p>
<pre class="code literal-block"><span></span><span class="k">[code lang=python]</span>
<span class="na">import recipy</span>
<span class="k">[/code]</span>
</pre>


<p>With this single line, your script will now generate an entry in a database every time it is run. It logs the start and end time, the working directory, the script's git hash, any differences between the working copy and the last git commit (!), and the names of any input and output files. (File hashes are coming soon, <a href="https://twitter.com/sciremotesense/status/646951148608425984">I’m assured</a>).
I don’t know about you but I have definitely lost count of the times I’ve looked at a file and wondered what script I ran to get it, or the input data that went into it. This library solves that problem with absolutely minimal friction for the user.
I also enjoyed Nicolas Rougier’s <a href="https://youtu.be/orLYVhSrOwk">talk</a> on <a href="https://rescience.github.io">ReScience</a>, a new journal dedicated to replicated (and replicable) scientific analyses. It’s a venue to publish all those efforts to replicate a result you read in a paper. Given recent findings about how <em>poorly</em> most papers replicate, I think this is a really important outlet.
The other remarkable thing about it is that all review is open and done in the spirit of open source, on GitHub. Submission is by <a href="https://help.github.com/articles/using-pull-requests/">pull request</a>, of course. With just one paper out so far, it’s a bit early to tell whether it’ll take off, but I really hope it does. I’ll be looking for stuff of my own to publish there, for sure. (Oh and by the way, they are <a href="http://rescience.github.io/faq/">looking for reviewers and editors!</a>)
Another great <a href="https://youtu.be/_vMq8Z82poA">talk</a> was Philipp Rudiger on <a href="http://holoviews.org">HoloViews</a>, an object-oriented plotting framework. They define an arithmetic on figures: <code>A * B</code> overlays figure B on A, while <code>B + C</code> creates two subplots out of B and C (and automatically labels them). Their <a href="http://holoviews.org/Examples/index.html">example notebooks</a> rely a lot on IPython magic, which I’m not happy about and means I haven’t fully grokked the API, but it seems like a genuinely useful way to think about plotting.
A final highlight from the main session was <a href="https://youtu.be/MeFsmFTU2JQ">Martin Weigert on Spimagine</a>, his GPU-accelerated, 5D image analysis and visualisation framework. It was stupidly impressive. Although it’s a long-term project, I’m inclined to try to incorporate many of its components into <a href="http://scikit-image.org">scikit-image</a>.</p>
<h3>Tutorials</h3>

<p>The tutorials are a great asset of both EuroSciPy and SciPy. I learn something new every year. The highlight for me was the <a href="https://youtu.be/GmxZfZjEjZo">Cython tutorial</a>, in which Stefan Behnel demonstrated how easy it is to provide Python access to C++ code using Cython. (I have used Cython quite extensively, but only to speed up Python code, rather than wrap C or C++ code.)</p>
<h3>Sprints</h3>

<p>I was feeling a bit hypocritical for missing the sprints this year, since I had to run off before the Sunday. Emmanuelle Gouillart, another scikit-image core dev, suggested having a small, unofficial sprint on Friday evening. It grew and grew into a group of about 30 people (including about 10 new to sprinting) who all gathered at the Enthought Cambridge office to work on scikit-image or the <a href="http://www.scipy-lectures.org">SciPy lecture notes</a>. A brilliant experience.
<img src="https://pbs.twimg.com/media/CNg3PuJWgAAj0Qq.jpg" alt="scikit-image sprint at Enthought">
(By the way, nothing creepy going on with that dude hunching over one of our sprinters — that's just husband-and-wife team Olivia and Robin Wilson! ;)</p>
<h3>Final thoughts</h3>

<p>As usual, I learned heaps and had a blast at this SciPy conference (my fourth). I hope it will remain a yearly ritual, and I hope someone reading this will give it a try next year!</p>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="." rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-5.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><footer id="footer"><p>Contents © 2019         <a href="mailto:jni.soma@gmail.com">Juan Nunez-Iglesias</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    </div>
    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
    
    
    
            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
